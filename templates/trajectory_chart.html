{% extends 'base.html' %}
{% load static %}
{% block extra_head %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function(){
    var demostrativo = {{ demostrativo|lower }};

    var xData = [1.8, 1.6, 1.1, 0.6, -0.4, -1.4, -2.4, -4.5, -7.7, -13.1, -21, -30.2, -40.8, -52.6, -65.3, -79.5, -95.4, -113, -130.9, -149, -167.8, -186.3, -203.8, -219.9, -234.8, -248.5, -260.3, -269.6, -276.8, -280.6, -282.2, -282.3, -282.2, -282.3, -282.2, -282.4, -282.6, -282.5, -282.6, -283.2, -283.9, -283.9, -283.7, -283.6, -283.5, -283.5, -283.4, -283.2, -283.1, -282.8, -282.6, -282.8, -282.9, -282.9, -283.1, -283, -282.6, -281.8, -281.1, -280.1, -278.7, -277.3, -276, -275.2, -275.3, -275.5, -275.1, -274.9, -274.7, -274.1, -273.6, -272.9, -272.5, -272.2, -272.1, -271.8, -271.3, -271];
    var yData = [2.8, 4.6, 9.5, 15.8, 24.1, 31.9, 39.2, 47, 55.5, 64.1, 71.8, 78.1, 82.5, 85.5, 86.2, 84.1, 81.8, 80.1, 78.4, 77.3, 77.7, 79.1, 80.7, 80.7, 79.7, 79.2, 79.7, 80.4, 80.9, 81.1, 80.7, 79.9, 79.5, 79.5, 79.1, 78.3, 77.8, 77.5, 77.2, 77, 77, 77.5, 78.2, 78.5, 78.5, 78.5, 79, 80.1, 81.3, 82.4, 83.6, 84.7, 85.5, 86, 86.8, 87.6, 88.6, 90, 90.7, 90.7, 90.3, 90.1, 89.9, 89.3, 88.6, 87.8, 87.7, 87.8, 87.9, 87.9, 87.6, 87.2, 87.1, 87, 86.9, 86.8, 86.8, 87];
    var zData = [761, 854, 978.9, 1072.7, 1167.3, 1261, 1354.7, 1449.3, 1542.9, 1637.3, 1730.7, 1825, 1918.3, 2012.5, 2105.7, 2199.6, 2292.2, 2384.5, 2477.8, 2570, 2663.1, 2755.3, 2848.6, 2941.3, 3035.1, 3129.1, 3223.3, 3315.9, 3412.6, 3505.5, 3599.5, 3693.5, 3788.5, 3882.5, 3977.5, 4071.5, 4166.5, 4260.5, 4355.5, 4449.5, 4544.5, 4638.5, 4733.5, 4828.5, 4922.5, 5017.5, 5112.5, 5206.5, 5301.5, 5395.4, 5490.4, 5584.4, 5679.4, 5773.4, 5868.4, 5962.4, 6057.4, 6151.4, 6246.4, 6340.4, 6435.4, 6529.4, 6624.4, 6718.3, 6813.3, 6907.3, 7002.3, 7097.3, 7191.3, 7286.3, 7380.3, 7475.3, 7515.3, 7569.3, 7600.3, 7664.3, 7723.3, 7782.3];

    if (demostrativo) {
        for (var i = 0; i < xData.length; i++) {
            var newRow = `<tr>
                <td><input type="text" name="x[]" value="${xData[i]}" required></td>
                <td><input type="text" name="y[]" value="${yData[i]}" required></td>
                <td><input type="text" name="z[]" value="${zData[i]}" required></td>
                <td><button type="button" class="remove-row btn btn-danger">Eliminar</button></td>
            </tr>`;
            $("#data-table tbody").append(newRow);
        }
    }

    $("#add-row").click(function(){
        var newRow = `<tr>
            <td><input type="text" name="x[]" required></td>
            <td><input type="text" name="y[]" required></td>
            <td><input type="text" name="z[]" required></td>
            <td><button type="button" class="remove-row btn btn-danger">Eliminar</button></td>
        </tr>`;
        $("#data-table tbody").append(newRow);
    });

    $(document).on('click', '.remove-row', function(){
        $(this).closest('tr').remove();
    });

    $("#data-form").submit(function(event){
        event.preventDefault();
        var data = $(this).serialize();
        $.post("{% url 'trajectory_chart' %}", data, function(response){
            $("#plot-div-3d").html(response.plot_div_3d);
        });
    });
});
</script>
<style>
    body {
        background-color: rgb(245, 245, 245);
    }
    .principalContainer {
        max-height: 100vh;
        border: 1px solid black;
    }
    .principalDataContainer {
        max-height: 95vh;
        overflow-y: scroll;
        border-right: 1px solid black;
    }
    .cabeceraTable {
        border-top: 1px solid black;
    }
    .titleTable {
        padding-top: 7px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row principalContainer">
    <div class="col-6 principalDataContainer">
        <h3 class="titleTable">Tabla de Datos</h3>
        <form id="data-form" method="post">
            {% csrf_token %}
            <button class="btn btn-primary mt-1 mb-1" type="submit">Enviar datos</button>
            <table class="table table-striped" id="data-table" border="1">
                <thead>
                    <tr class="position-relative cabeceraTable">
                        <th>N/S (ft)</th>
                        <th>E/W (ft)</th>
                        <th>TVD (ft)</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" name="x[]" required></td>
                        <td><input type="text" name="y[]" required></td>
                        <td><input type="text" name="z[]" required></td>
                        <td><button type="button" class="remove-row btn btn-danger">Eliminar</button></td>
                    </tr>
                </tbody>
            </table>
            <button class="btn btn-info mb-2" type="button" id="add-row">Añadir fila</button>
        </form>
    </div>
    
    <div class="col-6">
        <h3>Gráfico 3D Survey</h3>
        <div class="w-100 p-0" id="plot-div-3d">{{ plot_div_3d|safe }}</div>
    </div>
</div>




{% endblock %}
